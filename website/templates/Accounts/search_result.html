{% extends "Accounts/Acc_base.html" %}
{% block title %}Accounts Search_result{% endblock %}
{% block content %}

<div class="container">
    {% with errors = get_flashed_messages(category_filter=["error","success"]) %}
    {% if errors %}
    <div class="alert alert-danger">
        <ul>
            {%- for msg in errors %}
            <h3>{{ msg }}</h3>
            {% endfor -%}
        </ul>
    </div>
    {% endif %}
    {% endwith %}

    <h2 class="centered-heading">Circle: {{ circle | upper }} and Employee Type: {{ emp_type | upper }}</h2>

    {% if admin_data %}
    <div class="d-flex justify-content-between mb-3">
        <h4>Search Results:</h4>
    </div>

    <table class="table table-striped">
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Bank Details</th>
                <th>Update</th>
                <th>Total Working Days</th>
            </tr>
        </thead>
        <tbody>
            {% for item in admin_data %}
            <tr>
                <td>{{ item.name }}</td>
                <td>{{ item.email }}</td>
                <td>
                    <a href="{{ url_for('Accounts.view_documents', admin_id=item.id) }}">
                        View
                    </a>
                </td>
                <td>
                    <a href="{{ url_for('Accounts.add_payslip', admin_id=item.id) }}">Add PaySlip</a>
                </td>
                <td>{{ item.total_days }}</td>
            </tr>
            {% endfor %}
        </tbody>

    </table>
    {% else %}
    <p>No matching entries found.</p>
    {% endif %}


    <a href="{{ url_for('Accounts.Acc_dashboard') }}" class="btn btn-primary search">Back to Search</a>

    <a href="#" id="toggleMonthForm"
   class="btn mt-3"
   style="background-color: #28a745; color: white; padding: 8px 16px; border-radius: 5px; text-decoration: none;">
   ðŸ“¥ Download Attendance Excel File
</a>

<!-- Hidden month selector form -->
<div id="monthForm" class="mt-3"
     style="display: none; background-color: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
  <form method="get" action="{{ url_for('Accounts.download_excel_acc') }}">
    <div class="form-group mb-3">
      <label for="month" style="font-weight: 600;">Select Month:</label>
      <input type="month"
             id="month"
             name="month"
             class="form-control"
             value="{{ now().astimezone(pytz.timezone('Asia/Kolkata')).strftime('%Y-%m') }}"
             required>
    </div>
    <div>
      <button type="submit"
              class="btn"
              style="background-color: #218838; color: white; padding: 6px 16px; border-radius: 5px;">
        Download
      </button>
      <button type="button"
              id="cancelForm"
              class="btn btn-secondary"
              style="margin-left: 8px;">
        Cancel
      </button>
    </div>
  </form>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const toggleBtn = document.getElementById("toggleMonthForm");
    const formBox = document.getElementById("monthForm");
    const cancelBtn = document.getElementById("cancelForm");

    toggleBtn.addEventListener("click", function(event) {
      event.preventDefault();
      if (formBox.style.display === "none") {
        formBox.style.display = "block";
        toggleBtn.innerHTML = "ðŸ”½ Hide Month Selector";
      } else {
        formBox.style.display = "none";
        toggleBtn.innerHTML = "ðŸ“¥ Download Attendance Excel File";
      }
    });

    cancelBtn.addEventListener("click", function() {
      formBox.style.display = "none";
      toggleBtn.innerHTML = "ðŸ“¥ Download Attendance Excel File";
    });
  });
</script>




    <a href="{{ url_for('Accounts.upload_payslips') }}" class="btn mt-3"
        style="background-color: #d8ad10; color: white; padding: 8px 16px; border-radius: 5px; text-decoration: none;">
        Upload Payslips In Bulk
    </a>

</div>

{% endblock %}